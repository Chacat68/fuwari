# 基于时间的主题自动切换功能

## 功能概述

本次更新为网站实现了基于时间的主题自动切换功能，让主题能够根据一天中的时间自动在亮色和暗色之间切换，提供更好的用户体验。

## 实现细节

### 1. 时间规则
- **亮色模式**：6:00 - 18:00（白天时间）
- **暗色模式**：18:00 - 6:00（夜晚时间）

### 2. 主题模式
网站现在支持三种主题模式：
- **亮色模式**：强制使用亮色主题
- **暗色模式**：强制使用暗色主题  
- **自动模式**：根据时间自动切换（默认模式）

### 3. 技术实现

#### 核心函数
- `getTimeBasedTheme()`: 根据当前时间返回应该使用的主题
- `applyThemeToDocument()`: 应用主题到文档，支持时间判断
- 精确切换机制：在固定时间点（6:00和18:00）进行主题切换

#### 文件修改
1. **src/constants/constants.ts**
   - 将默认主题从 `DARK_MODE` 改为 `AUTO_MODE`

2. **src/utils/setting-utils.ts**
   - 新增 `getTimeBasedTheme()` 函数
   - 更新 `applyThemeToDocument()` 函数，支持时间判断

3. **src/components/LightDarkSwitch.svelte**
   - 添加精确时间切换机制
   - 在 AUTO_MODE 时计算并等待下一个切换时间点（6:00或18:00）

4. **src/layouts/Layout.astro**
   - 更新内联脚本，支持基于时间的主题判断

### 4. 明暗适配修复

#### 修复的问题
1. **friends.astro**
   - 修复复制按钮的硬编码灰色背景
   - 修复邮件模板的硬编码背景色
   - 添加完整的明暗模式适配

2. **about.astro**
   - 将硬编码的十六进制颜色值替换为主题适配的 Tailwind 类名
   - 统一使用 `text-blue-400 dark:text-blue-300` 替代 `text-[#86A3D5]`

3. **OptimizedImage.astro**
   - 为懒加载占位符添加暗色模式样式
   - 使用渐变背景适配不同主题

## 用户体验

### 自动化切换
- 用户选择"自动模式"后，主题会根据时间自动切换
- 无需手动干预，提供无缝的视觉体验

### 手动控制
- 用户仍可手动选择亮色或暗色模式
- 手动选择的模式优先级高于时间判断

### 性能优化
- 使用精确的时间调度，只在切换时间点触发
- 只在 AUTO_MODE 时启动时间调度
- 切换模式时自动清理定时器
- 避免频繁的时间检查，大幅减少性能开销

## 兼容性

- 完全向后兼容现有的主题系统
- 保持原有的系统主题跟随功能作为备选方案
- 支持所有现代浏览器

## 配置选项

如需调整时间规则，可修改 `src/utils/setting-utils.ts` 中的 `getTimeBasedTheme()` 函数：

```typescript
// 当前规则：6:00-18:00 亮色，18:00-6:00 暗色
if (hour >= 6 && hour < 18) {
    return LIGHT_MODE;
}
return DARK_MODE;
```

## 技术细节

### 精确切换机制
- **计算逻辑**：根据当前时间计算距离下一个切换时间点的精确毫秒数
- **切换时间**：6:00（亮色→暗色）和18:00（暗色→亮色）
- **调度方式**：使用 `setTimeout` 而非 `setInterval`，实现精确到秒的切换
- **自动重调度**：每次切换后自动计算并设置下次切换时间

### 性能优势
相比每分钟检查的方式，新的实现方式具有以下优势：
- **零频繁检查**：只在切换时间点触发，其他时间完全无开销
- **精确切换**：切换时间精确到秒，不会延迟
- **资源友好**：大幅减少CPU和内存使用

## 测试建议

1. 在接近切换时间点（如17:59或5:59）测试自动切换功能
2. 验证手动模式选择不受时间影响
3. 检查页面刷新后主题状态保持正确
4. 确认所有页面都正确适配明暗变化
5. 测试长时间运行后的内存使用情况
